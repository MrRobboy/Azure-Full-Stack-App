<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Cross-domain communication</title>
		<script>
			// Setup the message handler for cross-domain communication
			window.addEventListener("message", function (event) {
				// Only accept messages from our frontend
				if (
					event.origin !==
					"https://app-frontend-esgi-app.azurewebsites.net"
				) {
					console.error(
						"Rejected message from unauthorized origin:",
						event.origin
					);
					return;
				}

				// Process the message and send a response
				try {
					const request = event.data;
					console.log(
						"Received request:",
						request
					);

					// Determine response type
					if (request.type === "ping") {
						// Simple ping response
						event.source.postMessage(
							{
								type: "pong",
								message: "Backend server is online",
								timestamp: new Date().toISOString(),
								success: true
							},
							event.origin
						);
					} else if (request.type === "api") {
						// Simple API response simulation
						event.source.postMessage(
							{
								type: "api_response",
								success: true,
								data: {
									message: "API is working",
									server: window
										.location
										.host,
									timestamp: new Date().toISOString()
								}
							},
							event.origin
						);
					}
				} catch (error) {
					console.error(
						"Error processing message:",
						error
					);
					event.source.postMessage(
						{
							type: "error",
							success: false,
							error: error.message
						},
						event.origin
					);
				}
			});

			// Log that the page is loaded
			console.log(
				"Cross-domain communication bridge is loaded and ready"
			);
		</script>
	</head>
	<body>
		<h1>Cross-domain communication bridge</h1>
		<p>
			This page is used as a bridge for cross-domain
			communication between the frontend and backend.
		</p>
		<p>Status: <strong id="status">Ready</strong></p>

		<script>
			// Simple status check
			document.getElementById("status").textContent =
				"Active";
		</script>
	</body>
</html>
