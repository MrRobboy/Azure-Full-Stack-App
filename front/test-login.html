<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0" />
		<title>Test Login</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				max-width: 800px;
				margin: 20px auto;
				padding: 20px;
				line-height: 1.6;
			}
			.container {
				border: 1px solid #ddd;
				padding: 20px;
				border-radius: 5px;
				margin-bottom: 20px;
			}
			h2 {
				margin-top: 0;
				border-bottom: 1px solid #eee;
				padding-bottom: 10px;
			}
			button {
				padding: 8px 16px;
				background-color: #4caf50;
				color: white;
				border: none;
				border-radius: 4px;
				cursor: pointer;
				margin-right: 10px;
			}
			pre {
				background-color: #f5f5f5;
				padding: 15px;
				border-radius: 5px;
				overflow-x: auto;
				white-space: pre-wrap;
			}
			input {
				padding: 8px;
				margin-bottom: 10px;
				width: 100%;
				box-sizing: border-box;
			}
			label {
				display: block;
				font-weight: bold;
				margin-top: 10px;
			}
		</style>
	</head>
	<body>
		<h1>Login Test</h1>

		<div class="container">
			<h2>Try Login</h2>
			<p>
				Test the login functionality using the
				simple-proxy.php
			</p>

			<form id="loginForm">
				<label for="email">Email:</label>
				<input
					type="email"
					id="email"
					name="email"
					value="admin@test.com" />

				<label for="password">Password:</label>
				<input
					type="password"
					id="password"
					name="password"
					value="password" />

				<button type="submit">Test Login</button>
			</form>

			<h3>Result:</h3>
			<pre id="loginResult">Results will appear here...</pre>
		</div>

		<div class="container">
			<h2>Check Backend Status</h2>
			<p>Verify if the backend server is reachable</p>

			<button id="checkStatus">Check Status</button>

			<h3>Result:</h3>
			<pre id="statusResult">Results will appear here...</pre>
		</div>

		<script>
			document.getElementById("loginForm").addEventListener(
				"submit",
				async function (e) {
					e.preventDefault();
					const email =
						document.getElementById(
							"email"
						).value;
					const password =
						document.getElementById(
							"password"
						).value;
					const resultElement =
						document.getElementById(
							"loginResult"
						);

					resultElement.textContent =
						"Testing login...";

					try {
						const proxyUrl = `/simple-proxy.php?endpoint=api%2Fauth%2Flogin`;

						// First test if the proxy file exists
						try {
							const testResponse =
								await fetch(
									"/simple-proxy.php?endpoint=status.php"
								);
							resultElement.textContent += `\nProxy status test: ${
								testResponse.status
							} ${
								testResponse.ok
									? "OK"
									: "Failed"
							}\n`;
						} catch (testErr) {
							resultElement.textContent += `\nProxy test failed: ${testErr.message}\n`;
						}

						const response = await fetch(
							proxyUrl,
							{
								method: "POST",
								headers: {
									"Content-Type":
										"application/json"
								},
								body: JSON.stringify(
									{
										email,
										password
									}
								)
							}
						);

						const responseText =
							await response.text();
						let formattedResult;

						try {
							// Try to parse and prettify JSON
							const jsonData =
								JSON.parse(
									responseText
								);
							formattedResult =
								JSON.stringify(
									jsonData,
									null,
									2
								);
						} catch (e) {
							// If not JSON, just show as text
							formattedResult =
								responseText;
						}

						resultElement.textContent = `Status: ${
							response.status
						} ${
							response.ok
								? "OK"
								: "Failed"
						}\n\nResponse:\n${formattedResult}`;
					} catch (error) {
						resultElement.textContent = `Error: ${error.message}`;
					}
				}
			);

			document.getElementById("checkStatus").addEventListener(
				"click",
				async function () {
					const resultElement =
						document.getElementById(
							"statusResult"
						);
					resultElement.textContent =
						"Checking status...";

					try {
						const response = await fetch(
							"/simple-proxy.php?endpoint=status.php"
						);
						const responseText =
							await response.text();
						let formattedResult;

						try {
							// Try to parse and prettify JSON
							const jsonData =
								JSON.parse(
									responseText
								);
							formattedResult =
								JSON.stringify(
									jsonData,
									null,
									2
								);
						} catch (e) {
							// If not JSON, just show as text
							formattedResult =
								responseText;
						}

						resultElement.textContent = `Status: ${
							response.status
						} ${
							response.ok
								? "OK"
								: "Failed"
						}\n\nResponse:\n${formattedResult}`;
					} catch (error) {
						resultElement.textContent = `Error: ${error.message}`;
					}
				}
			);
		</script>
	</body>
</html>
