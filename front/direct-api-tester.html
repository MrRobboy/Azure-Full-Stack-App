<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0" />
		<title>Direct API Tester</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
			rel="stylesheet" />
		<style>
			pre {
				background-color: #f8f9fa;
				padding: 10px;
				border-radius: 4px;
				max-height: 400px;
				overflow: auto;
			}
			.endpoint-btn {
				margin-bottom: 5px;
			}
		</style>
	</head>
	<body>
		<div class="container mt-4 mb-5">
			<h1>Direct API Tester</h1>
			<p class="lead">
				Test API endpoints directly without using the
				proxy
			</p>

			<div class="row">
				<div class="col-md-4">
					<div class="card mb-4">
						<div
							class="card-header bg-primary text-white">
							Test Configuration
						</div>
						<div class="card-body">
							<form id="apiTestForm">
								<div
									class="mb-3">
									<label
										for="endpoint"
										class="form-label"
										>Endpoint</label
									>
									<input
										type="text"
										class="form-control"
										id="endpoint"
										name="endpoint"
										value="api-test.php" />
								</div>
								<div
									class="mb-3 form-check">
									<input
										type="checkbox"
										class="form-check-input"
										id="useApiPrefix"
										name="use_api_prefix" />
									<label
										class="form-check-label"
										for="useApiPrefix"
										>Use
										API
										Prefix</label
									>
								</div>
								<button
									type="submit"
									class="btn btn-primary">
									Test
									Endpoint
								</button>
							</form>
						</div>
					</div>

					<div class="card mb-4">
						<div
							class="card-header bg-success text-white">
							Common Endpoints
						</div>
						<div class="card-body">
							<div
								class="d-grid gap-2">
								<button
									class="btn btn-sm btn-outline-primary endpoint-btn"
									data-endpoint="api-test.php"
									data-prefix="false">
									api-test.php
								</button>
								<button
									class="btn btn-sm btn-outline-primary endpoint-btn"
									data-endpoint="status.php"
									data-prefix="false">
									status.php
								</button>
								<button
									class="btn btn-sm btn-outline-primary endpoint-btn"
									data-endpoint="pure-cors-test.php"
									data-prefix="false">
									pure-cors-test.php
								</button>
								<button
									class="btn btn-sm btn-outline-primary endpoint-btn"
									data-endpoint="test-routing.php"
									data-prefix="false">
									test-routing.php
								</button>
								<button
									class="btn btn-sm btn-outline-primary endpoint-btn"
									data-endpoint="classes"
									data-prefix="true">
									api/classes
								</button>
								<button
									class="btn btn-sm btn-outline-primary endpoint-btn"
									data-endpoint="matieres"
									data-prefix="true">
									api/matieres
								</button>
								<button
									class="btn btn-sm btn-outline-primary endpoint-btn"
									data-endpoint="examens"
									data-prefix="true">
									api/examens
								</button>
								<button
									class="btn btn-sm btn-outline-primary endpoint-btn"
									data-endpoint="status"
									data-prefix="true">
									api/status
								</button>
								<button
									class="btn btn-sm btn-outline-primary endpoint-btn"
									data-endpoint="routes/api.php?resource=classes"
									data-prefix="false">
									routes/api.php?resource=classes
								</button>
								<button
									class="btn btn-sm btn-outline-warning endpoint-btn"
									data-endpoint=""
									data-prefix="true">
									api/
									(root)
								</button>
							</div>
						</div>
					</div>
				</div>

				<div class="col-md-8">
					<div class="card">
						<div
							class="card-header bg-info text-white">
							API Response
						</div>
						<div class="card-body">
							<div
								id="statusContainer"
								class="alert alert-secondary">
								Ready to test
								API endpoints
							</div>
							<div
								id="responseContainer"
								class="d-none">
								<h5>
									Response:
								</h5>
								<pre
									id="responseOutput"></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			document.addEventListener(
				"DOMContentLoaded",
				function () {
					const apiTestForm =
						document.getElementById(
							"apiTestForm"
						);
					const statusContainer =
						document.getElementById(
							"statusContainer"
						);
					const responseContainer =
						document.getElementById(
							"responseContainer"
						);
					const responseOutput =
						document.getElementById(
							"responseOutput"
						);
					const endpointInput =
						document.getElementById(
							"endpoint"
						);
					const useApiPrefixCheckbox =
						document.getElementById(
							"useApiPrefix"
						);

					// Test form submission
					apiTestForm.addEventListener(
						"submit",
						function (e) {
							e.preventDefault();
							testApiEndpoint(
								endpointInput.value,
								useApiPrefixCheckbox.checked
							);
						}
					);

					// Quick endpoint buttons
					document.querySelectorAll(
						".endpoint-btn"
					).forEach((button) => {
						button.addEventListener(
							"click",
							function () {
								const endpoint =
									this.getAttribute(
										"data-endpoint"
									);
								const usePrefix =
									this.getAttribute(
										"data-prefix"
									) ===
									"true";

								endpointInput.value =
									endpoint;
								useApiPrefixCheckbox.checked =
									usePrefix;

								testApiEndpoint(
									endpoint,
									usePrefix
								);
							}
						);
					});

					// Function to test API endpoint
					function testApiEndpoint(
						endpoint,
						useApiPrefix
					) {
						statusContainer.className =
							"alert alert-info";
						statusContainer.textContent =
							"Testing endpoint...";
						responseContainer.classList.add(
							"d-none"
						);

						const url = `test-direct-api.php?endpoint=${encodeURIComponent(
							endpoint
						)}&use_api_prefix=${
							useApiPrefix ? "1" : "0"
						}`;

						fetch(url)
							.then((response) =>
								response.json()
							)
							.then((data) => {
								// Show response
								responseContainer.classList.remove(
									"d-none"
								);
								responseOutput.textContent =
									JSON.stringify(
										data,
										null,
										2
									);

								// Update status
								if (
									data.success
								) {
									statusContainer.className =
										"alert alert-success";
									statusContainer.textContent = `Success! Status: ${data.http_status}`;
								} else {
									statusContainer.className =
										"alert alert-danger";
									const errorMsg =
										data.error_message ||
										`Error: HTTP ${data.http_status}`;
									statusContainer.textContent =
										errorMsg;
								}
							})
							.catch((error) => {
								statusContainer.className =
									"alert alert-danger";
								statusContainer.textContent = `Error: ${error.message}`;
								responseContainer.classList.remove(
									"d-none"
								);
								responseOutput.textContent =
									JSON.stringify(
										{
											error: error.message
										},
										null,
										2
									);
							});
					}

					// Test api-test.php initially
					testApiEndpoint("api-test.php", false);
				}
			);
		</script>
	</body>
</html>
