<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0" />
		<title>Test CORS</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
			rel="stylesheet" />
		<style>
			pre {
				background-color: #f5f5f5;
				padding: 15px;
				border-radius: 5px;
				max-height: 300px;
				overflow: auto;
			}
		</style>
	</head>
	<body>
		<div class="container mt-5">
			<h1>Test de CORS</h1>

			<div class="card mb-4">
				<div class="card-header">
					<h3>Configuration</h3>
				</div>
				<div class="card-body">
					<div class="mb-3">
						<label
							for="apiEndpoint"
							class="form-label"
							>Endpoint API</label
						>
						<input
							type="text"
							class="form-control"
							id="apiEndpoint"
							value="https://app-backend-esgi-app.azurewebsites.net/test-cors.php" />
					</div>
					<div class="mb-3">
						<label
							for="apiMethod"
							class="form-label"
							>Méthode HTTP</label
						>
						<select
							class="form-select"
							id="apiMethod">
							<option value="GET">
								GET
							</option>
							<option value="POST">
								POST
							</option>
							<option value="OPTIONS">
								OPTIONS
							</option>
						</select>
					</div>
					<div class="mb-3">
						<div class="form-check">
							<input
								class="form-check-input"
								type="checkbox"
								id="includeCredentials"
								checked />
							<label
								class="form-check-label"
								for="includeCredentials">
								Inclure les
								credentials
								(cookies)
							</label>
						</div>
					</div>
					<button
						id="testBtn"
						class="btn btn-primary">
						Tester la connexion
					</button>
				</div>
			</div>

			<div class="card mb-4">
				<div class="card-header">
					<h3>Résultat</h3>
				</div>
				<div class="card-body">
					<div
						id="status"
						class="alert alert-info">
						Prêt à tester
					</div>
					<h4>Réponse:</h4>
					<pre id="response">Aucune réponse</pre>
					<h4>En-têtes:</h4>
					<pre id="headers">Aucun en-tête</pre>
				</div>
			</div>
		</div>

		<script>
			document.addEventListener(
				"DOMContentLoaded",
				function () {
					const testBtn =
						document.getElementById(
							"testBtn"
						);
					const apiEndpoint =
						document.getElementById(
							"apiEndpoint"
						);
					const apiMethod =
						document.getElementById(
							"apiMethod"
						);
					const includeCredentials =
						document.getElementById(
							"includeCredentials"
						);
					const status =
						document.getElementById(
							"status"
						);
					const response =
						document.getElementById(
							"response"
						);
					const headers =
						document.getElementById(
							"headers"
						);

					testBtn.addEventListener(
						"click",
						async function () {
							status.className =
								"alert alert-info";
							status.textContent =
								"Test en cours...";
							response.textContent =
								"Chargement...";
							headers.textContent =
								"Chargement...";

							try {
								const fetchOptions =
									{
										method: apiMethod.value,
										credentials:
											includeCredentials.checked
												? "include"
												: "omit",
										headers: {
											"Content-Type":
												"application/json",
											"X-Requested-With":
												"XMLHttpRequest"
										}
									};

								// Exécuter la requête
								const fetchResponse =
									await fetch(
										apiEndpoint.value,
										fetchOptions
									);

								// Afficher les en-têtes
								const headerText =
									[];
								fetchResponse.headers.forEach(
									(
										value,
										name
									) => {
										headerText.push(
											`${name}: ${value}`
										);
									}
								);
								headers.textContent =
									headerText.join(
										"\n"
									);

								// Afficher la réponse
								const data =
									await fetchResponse.json();
								response.textContent =
									JSON.stringify(
										data,
										null,
										2
									);

								// Mettre à jour le statut
								status.className =
									"alert alert-success";
								status.textContent = `Succès! Statut: ${fetchResponse.status}`;
							} catch (error) {
								status.className =
									"alert alert-danger";
								status.textContent = `Erreur: ${error.message}`;
								response.textContent =
									"Erreur lors de la requête";
								console.error(
									"Erreur du test CORS:",
									error
								);
							}
						}
					);
				}
			);
		</script>
	</body>
</html>
